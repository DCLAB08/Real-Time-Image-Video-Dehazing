# FPGA Dehazer 💨🚫
The aim of this project is to achieve real time dehazing for video (or image).

We utilize DE2-115 FPGA, ethernet connection, camera TRDB-D5M and display through VGA in this project. 

With our own router, we achieve 10 FPS in RGB24 and 15 FPS in RGB16.

## Block Diagram
// TODO

## Introduction
This project is the final project for NTUEE DCLab 110-1.
Contributor:
* b07901001@g.ntu.edu.tw
* b07901021@g.ntu.edu.tw
* b07901036@g.ntu.edu.tw

## Feature
- Dehaze picture or video input via ethernet connection or camera
- Achieve real time usage


## Limitation
- Currently only support 640x480 image input
- For ethernet input, only support UDP protocol
- For ethernet input, only support RGB24/RGB16 bit input

## Usage
- You can use either **camera** or **ethernet** as your image input (refer to step below)
- Default ethernet
- Connect VGA to display
- Connect TRDB-D5M or ethernet wire to input image
- Use switch 1 for displaying transmission map
- Use switch 2 for displaying dehazed image
- Button 0 to reset VGA & SDRAM & Camera
- Button 1 to reset Ethernet and LCD

### Ethernet Input 🔌
Run FPGA and send image (or video) by python
> For ethernet & FPGA usage, we refer to alexforencich's project.
> [Reference here](https://github.com/alexforencich/verilog-ethernet/tree/master/example/DE2-115/fpga)

Make sure your PC (python) is in the same network as your FPGA

#### FPGA
- Please config src/Ethernet.v Line 200 and use your own IP address
- Config RGB16 in config.h (Default RGB24)
- ⚠️ **Remember to config HOST and PORT in src/Ethernet.v file for your FPGA IP address**

#### Python
- python/send_video.py: send mp4 file (**slower**)
- python/send_stream.py: send streaming image (HLS protocol) from provided URL (**slower**)
    > stream only support RGB24
- python/send_rawfile.py: send raw file (generated by video2file) (**faster**)
- python/video2file.py: convert mp4 into rawfile
- python/send_image.py: send jpg file
- ⚠️ **Remember to config HOST and PORT in each python file for your FPGA IP address**
> Because we use UDP protocol, please make sure your internet condition is good, otherwise some data might lost and cause display failure.
> In this case, you may increase the DELAY in python file to ensure the data was sent successfully (but lower FPS).

---

### Camera Input 📷
Config DE2-115/config.h and define Camera
> For TRDB-D5M & FPGA usage, we refer to Ahmed Abdelfattah's project.
> [Reference here](https://github.com/aabdelfattah/alhaitham-hardware)



## Compile
- For **camera** input, you can skip compilation and use DE2_115_camera.sof directly.
- For **ethernet** input,  make sure you modify IP address for FPGA and compile through Quartus.

#### 📝 File needed for compilation
// TODO




## Future work
- Support jpg input format and implement decoder on FPGA
- Support higher resolution
- Increase FPS
- Solve display failure issue